<!DOCTYPE html>

<html>

<meta charset="UTF-8">

<head>
<script src="math.js"></script>
<script type="text/javascript" src="weapons.js"></script>
<script type="text/javascript" src="plotly.min.js" charset="utf-8"></script>
<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="weaponList">
	<button onClick="testVariables()">testVariables</button>
	<form onClick="onChange()">
		<select id="mySelect" size=5>
			<option>AK47</option>
			<option>AK74</option>
			<option>AS Val</option>
			<option>test Weapon</option>
		</select>
	</form>
	
	<form onClick="onChange()">
		<input type="checkbox" name="Body" id="Body">
		<label for="Body">Body</label><br>
		<input type="checkbox" name="Torso" id="Torso">
		<label for="Torso">Torso</label><br>
		<input type="checkbox" name="Head" id="Head">
		<label for="Head">Head</label><br>
	</form>
</div>


<div id="cosie"></div>
<div id="plot"></div>

<script>
	function init()
	{
		var layout = 
		{
			xaxis: 
			{
				title: 'Range'
			},
			yaxis: 
			{
				title:'Damage'
			}
		};
		Plotly.newPlot('plot',layout, {staticPlot: true});
	}
	function onChange()
	{
		var x = document.getElementById("mySelect").value;
		document.getElementById("cosie").innerHTML = x;
		draw();
	}
	
	
	function testVariables()
	{
		var testVariable = document.querySelector('#Body').checked;
		alert(testVariable);
	}
	
	function getShotsToKill(maxDmg, minDmg, a, b, minRange, mul)
	{
		maxDmg*=mul;
		minDmg*=mul;
		var minShots = Math.ceil( 100/maxDmg );
		var maxShots = Math.ceil( 100/minDmg );
		
		var xSk = new Array(); // x for certain shots to kill
		var ySk = new Array(); // y for certain shots to kill
		var nameSk = new Array();
		
		xSk.push(0);
		ySk.push(maxDmg);
		nameSk.push(minShots);
		
		for(var i=minShots;i<maxShots;i++)
		{
			xSk.push( (((100/i)/mul)-b)/a );
			ySk.push( 100/i );
			nameSk.push(i+1);
		}
		if(100/minDmg == 100 / (100/maxShots))
		{
			xSk.push(minRange);
			ySk.push(100/maxShots);
			nameSk.push(maxShots+1);
		}
		
		return {xSk: xSk, ySk: ySk, nameSk: nameSk};
	}
	
	//Get weapon data and create x,y value pairs for graphs
	function getWeaponData()
	{
		// Get name selected weapon from weapon list, example:"AK47"
		var whatWeapon = document.getElementById("mySelect").value;
		
		// Get values for that weapon from weapons.js json file
		var maxDmg = weapons[whatWeapon].maxDmg;
		var minDmg = weapons[whatWeapon].minDmg;
		var maxRange = weapons[whatWeapon].maxRange;
		var minRange = weapons[whatWeapon].minRange;
		var headMul = weapons[whatWeapon].headMul;
		var torsoMul = weapons[whatWeapon].torsoMul;
		
		// calculate a,b for f(x)=ax+b
		var a = (maxDmg-minDmg)/(maxRange-minRange);
		var b = maxDmg-(maxRange*a);
		
		var bodyShotsToKill = getShotsToKill(maxDmg, minDmg, a, b, minRange, 1);
		//var torsoShotsToKill = getShotsToKill(maxDmg, minDmg, a, b, minRange, torsoMul);
		var headShotsToKill = getShotsToKill(maxDmg, minDmg, a, b, minRange, headMul);
		
		var traceTest = {
		x: bodyShotsToKill.xSk,
		y: bodyShotsToKill.ySk,
		mode: 'markers',
		type: 'scatter',
		name: bodyShotsToKill.nameSk.toString()
		};
		
		var traceTest2 = {
		x: headShotsToKill.xSk,
		y: headShotsToKill.ySk,
		mode: 'markers',
		type: 'scatter',
		name: headShotsToKill.nameSk.toString()
		};
		
		// initialize x number line for graph
		const xValues = math.range(0, minRange+40, 0.1).toArray();
		
		// get y values for creating graph
		var yBody= xValues.map(function(curr)
		{
			//[0,maxrange] -> constant function
			if(curr<=maxRange)
			{
				return maxDmg;
			}
			//[minRange,minRange+40] constant function
			else if(curr>=minRange)
			{
				return minDmg;
			}
			//(maxRange,minRange) linear function
			else
			{
				return (a*curr)+b;
			}
		});
		var yHead = xValues.map(function(curr)
		{
			//[0,maxrange] -> constant function
			if(curr<=maxRange)
			{
				return maxDmg*headMul;
			}
			//[minRange,minRange+40] constant function
			else if(curr>=minRange)
			{
				return minDmg*headMul;
			}
			//(maxRange,minRange) linear function
			else
			{
				return ((a*curr)+b)*headMul;
			}
		});
		var yTorso = xValues.map(function(curr)
		{
			//[0,maxrange] -> constant function
			if(curr<=maxRange)
			{
				return maxDmg*torsoMul;
			}
			//[minRange,minRange+40] constant function
			else if(curr>=minRange)
			{
				return minDmg*torsoMul;
			}
			//(maxRange,minRange) linear function
			else
			{
				return ((a*curr)+b)*torsoMul;
			}
		});
		
		const traceBody = 
		{
			x: xValues,
			y: yBody,
			type: 'scatter',
			name: 'Bodyshot'
		}
		const traceHead = 
		{
			x: xValues,
			y: yHead,
			type: 'scatter',
			name: 'Headshot'
		}	
		const traceTorso = 
		{
			x: xValues,
			y: yTorso,
			type: 'scatter',
			name: 'Torsoshot'
		}
		const body = [traceBody];
		const head = [traceHead];
		const torso = [traceTorso];
		const bodyTest = [traceTest];
		const headTest = [traceTest2];
		
		return {body: body, torso: torso, head: head, bodyTest: bodyTest, headTest: headTest};
	}
	
	
	// Plot the graphs
	function draw()
	{
		var weaponData = getWeaponData();
		var isBody = document.querySelector('#Body').checked;
		var isHead = document.querySelector('#Head').checked;
		var isTorso = document.querySelector('#Torso').checked;
		
		Plotly.react('plot');
		if(isBody == true)
		{
			Plotly.plot('plot',weaponData.body);
			Plotly.plot('plot',weaponData.bodyTest);
		}
		if(isTorso == true)
		{
			Plotly.plot('plot',weaponData.torso);
			Plotly.plot('plot',weaponData.torsoTest);
		}
		if(isHead == true)
		{
			Plotly.plot('plot',weaponData.head);
			Plotly.plot('plot',weaponData.headTest);
		}
		
    }
    init();
</script>

</body>
</html>
